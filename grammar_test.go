// -*- coding: utf-8 -*-

// Created on Tue Jul 29 10:12:42 AM EDT 2025
// author: Ryan Hildebrandt, github.com/ryancahildebrandt

package main

import (
	"bufio"
	"os"
	"os/exec"
	"slices"
	"strings"
	"testing"

	"github.com/stretchr/testify/assert"
	"gonum.org/v1/gonum/stat/combin"
)

func TestGrammar_print(t *testing.T) {
	var emp = "#JSGF V1.0 ISO8859-1 en;\n\ngrammar main;"
	var tk = NewUnigramTokenizer()

	type args struct {
		f string
	}
	tests := []struct {
		name string
		args args
		want string
	}{
		{name: "", args: args{f: "./data/tests/test1.csv"}, want: "#JSGF V1.0 ISO8859-1 en;\n\ngrammar main;\n\npublic <I_don't_have_a_profi_8> = (I don't have a profile);\npublic <I_don't_have_a_profi_9> = (I don't have a profile);\npublic <I_don't_have_a_user__10> = (I don't have a user account);\npublic <I_don't_have_an_onli_11> = (I don't have an online account);\npublic <I_don't_have_7> = (I don't have) (a account);\npublic <I_have_no_account_12> = (I have no account);\npublic <I_have_no_fucking_ac_13> = (I have no fucking account);\npublic <I_have_no_online_acc_14> = (I have no online account);\npublic <I_have_no_user_accou_15> = (I have no user account);\npublic <I_have_no_user_accou_16> = (I have no user account);\npublic <I_haven't_got_a_prof_17> = (I haven't got a profile);\npublic <I_haven't_got_a_user_18> = (I haven't got a user account);\npublic <I_haven't_got_an_acc_19> = (I haven't got an account);\npublic <I_haven't_got_an_onl_20> = (I haven't got an online account);\npublic <I_haven't_got_auser__21> = (I haven't got auser account);\npublic <I_need_a_user_accoun_22> = (I need a user account and I want to) (create one);\npublic <I_need_an_account_an_24> = (I need an account and I want to open one);\npublic <I_need_an_account_23> = (I need an account);\npublic <I_need_an_online_acc_25> = (I need an online account);\npublic <I_want_a_user_accoun_30> = (I want a user account);\npublic <I_want_a_user_accoun_31> = (I want a user account);\npublic <I_want_an_account_32> = (I want an account);\npublic <I_want_to_create_an__33> = (I want to create an online account);\npublic <I_want_to_know_if_I__36> = (I want to know if I can create more than one account with a single email);\npublic <I_want_to_know_if_I__37> = (I want to know if I can create more than one account with the same email address);\npublic <I_want_to_know_if_I__38> = (I want to know if I can create more than one online account with a single email address);\npublic <I_want_to_know_if_I__40> = (I want to know if I can register more than one user account with a single email address);\npublic <I_want_to_know_if_I__39> = (I want to know if I can register more than one user account with a single email);\npublic <I_want_to_know_if_I__41> = (I want to know if I can register several profiles with the same email address);\npublic <I_want_to_know_if_I__42> = (I want to know if I can register several user accounts with the same email address);\npublic <I_want_to_know_if_I__43> = (I want to know if I can register two accounts with a single email address);\npublic <I_want_to_know_if_I_34> = (I want to know if I) (can have several accounts);\npublic <I_want_to_know_if_I_35> = (I want to know if I) (can own several accounts);\npublic <I_want_to_open_a_use_44> = (I want to open a user account);\npublic <I_want_28> = (I want) (a profille);\npublic <to_knoe_if_I_can_cre_80> = (I want) (to knoe if I can create two profiles) (with an single email address);\npublic <to_nkow_if_I_can_reg_81> = (I want) (to nkow if I can register two accounts with the same email);\npublic <I_want_29> = (I want) (to register);\npublic <a_fucking_user_accou_45> = (I would like) (a fucking user account);\npublic <I'd_like_a_user_acco> = (I'd like a user account);\npublic <I've_got_no_account_1> = (I've got no account);\npublic <I've_got_no_account_2> = (I've got no account);\npublic <I've_got_no_profile_3> = (I've got no profile);\npublic <ask_an_agent_how_47> = (ask an agent how) (i could create a user account);\npublic <have_more_than_one_o_54> = (can i) (have more than one online account?);\npublic <register?_76> = (can i) (register?);\npublic <can_you_tell_me_if_I_49> = (can you tell me if I can create more than one user account with the same email?);\npublic <can_you_tell_me_if_I_50> = (can you tell me if I can register several accounts with a single email address?);\npublic <can_you_tell_me_if_I_51> = (can you tell me if I can register several accounts with a single email?);\npublic <can_you_tell_me_if_i_52> = (can you tell me if i can create more than) (one fucking user account with the same email?);\npublic <can_regisger_two_acc_48> = (can you tell me if i) (can regisger two accounts with a single email address?);\npublic <I_could_create_two_a_4> = (can you tell me if) (I could create two accounts with a single email);\npublic <I_create_two_online__6> = (can) (I create two online accounts with a single email?);\npublic <I_own_more_than_one__27> = (can) (I own more than one account?);\npublic <i_own_more_than_one__63> = (can) (i own more than one online account?);\npublic <could_you_ask_an_age_53> = (could you ask an agent how to open an account);\npublic <I_create_an_online_a_5> = (how can) (I create an online account?);\npublic <I_open_an_online_acc_26> = (how can) (I open an online account?);\npublic <i_dont_have_a_profil_58> = (i dont have a profile);\npublic <i_dont_have_a_user_a_59> = (i dont have a user account and i want to open one);\npublic <i_dont_have_a_57> = (i dont have a) (user accolunt);\npublic <i_dont_have_an_onlin_60> = (i dont have an online account);\npublic <i_dont_have_56> = (i dont have) (a account);\npublic <i_have_no_account_61> = (i have no account);\npublic <i_need_help_register_62> = (i need help registering);\npublic <i_wanna_know_if_i_ca_64> = (i wanna know if i can create more than one user account with a single email address);\npublic <i_wanna_know_if_i_ca_65> = (i wanna know if i can create two online accounts with a single email address);\npublic <i_wanna_know_if_i_ca_66> = (i wanna know if i can register more) (than oneuser account with the same email);\npublic <i_want_a_profile_67> = (i want a profile);\npublic <i_want_an_account_68> = (i want an account);\npublic <i_want_an_online_acc_69> = (i want an online account);\npublic <i_want_to_create_an__70> = (i want to create an account);\npublic <i_want_to_know_if_i__72> = (i want to know if i can create two accounts with a single email address);\npublic <i_want_to_know_if_i_71> = (i want to know if i) (can have several accounts);\npublic <i_could_create_two_p_55> = (i want to know if) (i could create two profiles with the same email address);\npublic <i_watn_to_know_if_i__73> = (i watn to know if i can register two profiles with the same email address);\npublic <ive_got_no_online_ac_74> = (ive got no online account);\npublic <please_75> = (please);\npublic <tell_me_if_I_can_cre_77> = (tell me if I can create two online accounts with the same email);\npublic <tell_me_if_I_can_reg_79> = (tell me if I can register two accounts with a single email address);\npublic <tell_me_if_I_can_reg_78> = (tell me if I can register two online accounts with the same email);\npublic <two_user_accounts_wi_82> = (tell me if I could register) (two user accounts with a single email address);\npublic <an_onlind_account_46> = (were to create) (an onlind account);"},
		{name: "", args: args{f: "./data/tests/test2.csv"}, want: "#JSGF V1.0 ISO8859-1 en;\n\ngrammar main;\n\npublic <I_acn't_understand_y> = (I acn't understand you);\npublic <I_ahve_a_problem_whe_1> = (I ahve a problem when trying to pay for my online order);\npublic <I_ahve_an_issue_when_2> = (I ahve an issue when trying) (to make a payment);\npublic <I_ahve_no_account_3> = (I ahve no account);\npublic <I_am_discontent_with_5> = (I am discontent with the service and I want) (to submit a consumer complaint);\npublic <I_am_discontent_with_4> = (I am discontent with the service);\npublic <I_am_happy_with_the__10> = (I am happy with the service and I'd like tro submit an opinion);\npublic <I_am_happy_with_the__9> = (I am happy with the service and I'd like) (to lodge a review);\npublic <I_am_happy_with_the__7> = (I am happy with the service and) (I would like to make an opinion);\npublic <I_am_happy_with_the__8> = (I am happy with the service and) (I would like to submit an opinion);\npublic <I_am_happy_with_the__6> = (I am happy with the service);\npublic <I_am_interested_in_t_11> = (I am interested in their fucking money back guarantee);\npublic <I_am_interested_in_y_12> = (I am interested in your fucking refund policy and I want to know about it);\npublic <I_am_interested_in_y_13> = (I am interested in your fucking reimbursement policy);\npublic <I_am_not_happy_with__15> = (I am not happy with the service and I want) (to lodge a complaint);\npublic <I_am_not_happy_with__14> = (I am not happy with the service);\npublic <I_ant_to_know_what_16> = (I ant to know what) (the mail address of the Customer Support is);\npublic <to_ask_for_informati_44> = (I ant) (to ask for information about modifying my purchase);\npublic <to_notify_problems_m_46> = (I ant) (to notify problems making a payment);\npublic <to_recover_my_passwo_47> = (I ant) (to recover my password);\npublic <I_awnna_know_somethi_17> = (I awnna know something about seeing an invoice);\npublic <I_boguht_a_product_18> = (I boguht a product);\npublic <I_bought_a_product_a_24> = (I bought a product and I want) (to change my purchase);\npublic <I_bought_a_product_a_25> = (I bought a product and I want) (to modify my order);\npublic <I_bought_a_product_a_26> = (I bought a product and I want) (to modify my purchase);\npublic <I_bought_a_product_a_22> = (I bought a product and) (I wanna change my purchase);\npublic <I_bought_a_product_a_23> = (I bought a product and) (I wanna modify my order);\npublic <I_bought_a_product_20> = (I bought a product);\npublic <I_bought_a_product_21> = (I bought a product);\npublic <I_bought_an_item_27> = (I bought an item);\npublic <I_bought_19> = (I bought) (a prodjct);\npublic <I_don't_have_an_onli_30> = (I don't have an online account);\npublic <I_forgot_my_password_31> = (I forgot my password and I want) (to retrieve it);\npublic <I_found_an_issue_ope_32> = (I found an issue opening an account);\npublic <I_have_a_problem_whe_34> = (I have a problem when trying to pay for my online order and) (I ant to notify it);\npublic <I_have_a_problem_whe_33> = (I have a problem when trying to pay);\npublic <I_have_no_user_accou_35> = (I have no user account);\npublic <I_need_help_informin_36> = (I need help informing of problems) (with my payment);\npublic <I_ordered_something_37> = (I ordered something);\npublic <I_can_know_where_my__29> = (I want to know how) (I can know where my deliveries are);\npublic <I_can_create_several_28> = (I want to know if) (I can create several profiles with) (the same email);\npublic <the_hours_of_Custome_42> = (I want to know what) (the hours of Customer Service are);\npublic <the_status_of_my_ord_43> = (I want to see) (the status of my order);\npublic <to_remove_my_online__48> = (I want) (to remove my online account);\npublic <to_track_my_deliveri_50> = (I want) (to track my deliveries);\npublic <to_view_your_payment_51> = (I want) (to view your payment options);\npublic <a_question_38> = (have) (a question);\npublic <a_user_account_39> = (havent got) (a user account) (and i wannaregister);\npublic <need_ehlp_modifying_40> = (need ehlp modifying) (my profile);\npublic <need_help_informing__41> = (need help informing of issues paying);\npublic <to_check_your_money__45> = (wan) (to check your money back guarantee);\npublic <want_to_know_if_52> = (want to know if) (I can track my shipments);\npublic <to_request_some_bill_49> = (want) (to request some bills);"},
		{name: "", args: args{f: "./data/tests/test3.csv"}, want: "#JSGF V1.0 ISO8859-1 en;\n\ngrammar main;\n\npublic <my_bills_and_I_want__84> = (<I_can't_find>) (my bills and I want to view them);\npublic <my_bills_and_I_want_83> = (<I_can't_find>) (my bills and I want) (to see them);\npublic <I_can't_find_41> = (<I_can't_find>) (my bills);\npublic <I_can't_find_42> = (<I_can't_find>) (my bills);\npublic <my_bklls_and_I_want_85> = (<I_can't_find>) (my bklls and I want) (to check them);\npublic <I_can't_find_43> = (<I_can't_find>) (my fucking bills);\npublic <I_can't_find_44> = (<I_can't_find>) (my fucking invoice);\npublic <my_invoices_and_I_wa_88> = (<I_can't_find>) (my invoices and I want) (to check them);\npublic <my_invoices_and_I_wa_89> = (<I_can't_find>) (my invoices and I want) (to see them);\npublic <I_can't_find_45> = (<I_can't_find>) (my invoices);\npublic <I_can't_find_46> = (<I_can't_find>) (my invoices);\npublic <I_acn't_understand_y> = (I acn't understand you);\npublic <I_ahve_a_problem_whe_1> = (I ahve a problem when trying) (to pay for my online order);\npublic <I_ahve_an_issue_when_2> = (I ahve an issue when trying) (to make a payment);\npublic <I_ahve_no_account_3> = (I ahve no account);\npublic <I_am_discontent_with_5> = (I am discontent with the service and I want) (to submit a consumer complaint);\npublic <I_am_discontent_with_4> = (I am discontent with the service);\npublic <I_am_happy_with_the__7> = (I am happy with the service and) (I would like to make an opinion);\npublic <I_am_happy_with_the__8> = (I am happy with the service and) (I would like to submit an opinion);\npublic <I_am_happy_with_the__9> = (I am happy with the service) (and I'd like to lodge a review);\npublic <and_I'd_like_tro_sub_75> = (I am happy with the service) (and I'd like tro submit an opinion);\npublic <I_am_happy_with_the__6> = (I am happy with the service);\npublic <I_am_interested_in_t_10> = (I am interested in their fucking money back guarantee);\npublic <I_am_interested_in_y_11> = (I am interested in your fucking refund policy and I want to know about it);\npublic <I_am_interested_in_y_12> = (I am interested in your fucking reimbursement policy);\npublic <I_am_not_happy_with__14> = (I am not happy with the service and I want) (to lodge a complaint);\npublic <I_am_not_happy_with__13> = (I am not happy with the service);\npublic <I_ant_to_know_what_16> = (I ant to know what) (the mail address of the Customer Support is);\npublic <to_ask_for_informati_96> = (I ant) (to ask for information about modifying my purchase);\npublic <to_notify_problems_m_98> = (I ant) (to notify problems making) (a payment);\npublic <I_ant_15> = (I ant) (to recover my password);\npublic <I_awnna_know_somethi_17> = (I awnna know something about seeing) (an invoice);\npublic <I_boguht_a_product_18> = (I boguht a product);\npublic <I_bought_a_product_a_25> = (I bought a product and I want to change my purchase);\npublic <I_bought_a_product_a_26> = (I bought a product and I want to modify my order);\npublic <I_bought_a_product_a_27> = (I bought a product and I want to modify my purchase);\npublic <I_bought_a_product_a_23> = (I bought a product and) (I wanna change my purchase);\npublic <I_bought_a_product_a_24> = (I bought a product and) (I wanna modify my order);\npublic <I_bought_a_product_21> = (I bought a product);\npublic <I_bought_a_product_22> = (I bought a product);\npublic <I_bought_an_item_and_30> = (I bought an item and I want to change my order);\npublic <I_bought_an_item_and_31> = (I bought an item and I want to change my purchase);\npublic <I_bought_an_item_and_32> = (I bought an item and I want to modify my order);\npublic <I_bought_an_item_and_33> = (I bought an item ands I want to modify my purchase);\npublic <and_i'd_like_to_modi_77> = (I bought an item) (and i'd like to modify my order);\npublic <I_bought_an_item_28> = (I bought an item);\npublic <I_bought_an_item_29> = (I bought an item);\npublic <I_bought_something_a_35> = (I bought something and I want to change my order);\npublic <I_bought_something_a_36> = (I bought something and I want to change my purchase);\npublic <I_bought_something_a_37> = (I bought something and I want to modify my order);\npublic <I_wanna_change_my_pu_66> = (I bought something and) (I wanna change my purchase);\npublic <and_Id_like_to_chang_76> = (I bought something) (and Id like to change my purchase);\npublic <and_want_to_modify_m_78> = (I bought something) (and want to modify my purchase);\npublic <I_bought_something_34> = (I bought something);\npublic <I_bought_19> = (I bought) (a prodjct);\npublic <I_bought_20> = (I bought) (an product);\npublic <I_bougyt_an_item_38> = (I bougyt an item);\npublic <I_bouvht_a_product_a_39> = (I bouvht a product and I want to change my order);\npublic <I_ca't_remember_40> = (I ca't remember) (my password);\npublic <my_fucking_password__86> = (I can' remember) (my fucking password and) (I would like to reset it);\npublic <a_profile_71> = (I can't create) (a profile);\npublic <my_invoices_87> = (I can't dind) (my invoices);\npublic <my_bills_82> = (I can't fidn) (my bills);\npublic <I_can't_find_my_bill_51> = (I can't find my bill and I want to view it);\npublic <I_can't_find_my_bill_49> = (I can't find my bill and I want) (to check it);\npublic <I_can't_find_my_bill_50> = (I can't find my bill and I want) (to see it);\npublic <and_I'd_like_to_view_74> = (I can't find my bill) (and I'd like to view it);\npublic <I_can't_find_my_bill_47> = (I can't find my bill);\npublic <I_can't_find_my_bill_48> = (I can't find my bill);\npublic <I_would_like_to_view_70> = (I can't find my fucking invoices and) (I would like to view them);\npublic <I_can't_find_my_invo_56> = (I can't find my invoice and I want to view it);\npublic <I_can't_find_my_invo_55> = (I can't find my invoice and I want) (to check it);\npublic <I_can't_find_my_invo_57> = (I can't find my invoice andI want) (to see it);\npublic <I_can't_find_my_invo_52> = (I can't find my invoice);\npublic <I_can't_find_my_invo_53> = (I can't find my invoice);\npublic <I_can't_find_my_invo_54> = (I can't find my invoice);\npublic <I_don't_have_59> = (I don't have) (an online account);\npublic <my_password_and_I_wa_91> = (I forgot) (my password and I want) (to retrieve it);\npublic <I_found_an_issue_ope_60> = (I found an issue opening) (an account);\npublic <I_have_a_problem_whe_62> = (I have a problem when trying) (to pay for my online order and I ant to notify it);\npublic <I_have_a_problem_whe_61> = (I have a problem when trying) (to pay);\npublic <I_have_no_user_accou_63> = (I have no user account);\npublic <I_need_help_informin_64> = (I need help informing of problems) (with my payment);\npublic <I_ordered_something_65> = (I ordered something);\npublic <I_want_to_know_how_68> = (I want to know how) (I can know where my deliveries are);\npublic <I_can_create_several_58> = (I want to know if) (I can create several profiles with) (the same email);\npublic <the_hours_of_Custome_94> = (I want to know what) (the hours of Customer Service are);\npublic <my_online_account_90> = (I want to remove) (my online account);\npublic <the_status_of_my_ord_95> = (I want to see) (the status of my order);\npublic <I_want_to_view_your__69> = (I want to view your payment options);\npublic <I_want_67> = (I want) (to track my deliveries);\npublic <bought_na_item_79> = (I) (bought na item);\npublic <bought_somethikng_80> = (I) (bought somethikng);\npublic <can't_understand_you_81> = (I) (can't understand you);\npublic <a_question_72> = (have) (a question);\npublic <a_user_account_73> = (havent got) (a user account) (and i wannaregister);\npublic <need_ehlp_modifying_92> = (need ehlp modifying) (my profile);\npublic <need_help_informing__93> = (need help informing of issues paying);\npublic <to_check_your_money__97> = (wan) (to check your money back guarantee);\npublic <want_to_know_if_100> = (want to know if) (I can track my shipments);\npublic <to_request_some_bill_99> = (want) (to request some bills);\n\n<I_can't_find> = (I can't find);"},
		{name: "", args: args{f: "./data/tests/test4.csv"}, want: "#JSGF V1.0 ISO8859-1 en;\n\ngrammar main;\n\npublic <I_bought_3> = (I bought) (an item);\npublic <I_can't_find_4> = (I can't find) (my bill);\npublic <I_can't_find_5> = (I can't find) (my bills);\npublic <my_invoice_and_I_wan_77> = (I can't find) (my invoice and I want to view it);\npublic <I_can't_find_6> = (I can't find) (my invoice);\npublic <I_can't_remember_7> = (I can't remember) (my passwprd);\npublic <I_changed_11> = (I changed) (my mind);\npublic <I_didn't_receive_12> = (I didn't receive) (my invoices);\npublic <an_online_account_44> = (I don't have) (an online account);\npublic <I_don't_know_anythin_13> = (I don't know anything about your money back guarantee and I want information about it);\npublic <I_don't_know_anythin_14> = (I don't know anything about your money back policy and I want information about it);\npublic <I_don't_know_anythin_15> = (I don't know anything about your refund policy);\npublic <I_get_an_error_when_16> = (I get an error when) (I attempt to pay);\npublic <I_attempted_to_pay_2> = (I got an erreor when) (I attempted to pay);\npublic <I_attempted_to_make__1> = (I got an error message when) (I attempted to make a payment);\npublic <I_have_a_problem_whe_17> = (I have a problem when trying ot make a payment with card);\npublic <I_have_a_problem_whe_18> = (I have a problem when trying to make a payment);\npublic <I_have_a_problem_whe_19> = (I have a problem when trying to pay);\npublic <I_have_an_issue_maki_20> = (I have an issue making) (a paymet);\npublic <I_have_an_issue_payi_21> = (I have an issue paying for my order);\npublic <I_have_no_shipping_a_22> = (I have no shipping address);\npublic <I_need_help_viewing_23> = (I need help viewing) (my bills);\npublic <I_need_information_24> = (I need information);\npublic <I_want_a_reimburseme_30> = (I want a reimbursement);\npublic <about_obtaining_an_i_42> = (I want to ask for information) (about obtaining an invoice);\npublic <to_change_my_order_88> = (I want to know how) (to change my order);\npublic <I_want_to_make_31> = (I want to make) (a comment);\npublic <I_want_to_make_32> = (I want to make) (a complaint for a service);\npublic <my_other_account_79> = (I want to use) (my other account);\npublic <I_want_to_view_cance_33> = (I want to view cancellation penalties);\npublic <I_want_to_view_your__34> = (I want to view your reimbursement policy);\npublic <I_want_28> = (I want) (to download a bill);\npublic <to_get_information_a_89> = (I want) (to get information about downloading some invoices);\npublic <I_want_29> = (I want) (to submit a complaint);\npublic <to_see_the_status_of_93> = (I'd like) (to see the status of my order);\npublic <I'm_happy_wiht> = (I'm happy wiht) (the service);\npublic <I_try_to_pay_for_my__27> = (an error message pops when) (I try to pay for my order);\npublic <ask_an_agent_how_47> = (ask an agent how) (to file an consumer complaint);\npublic <ask_an_agent_how_48> = (ask an agent how) (to modufy my purchase);\npublic <can_report_an_issue__51> = (ask an agent where i) (can report an issue paying);\npublic <to_show_me_informati_94> = (ask an agent) (to show me information about) (the delivery period);\npublic <a_purchase?_38> = (can I cancel) (a purchase?);\npublic <my_account_password?_76> = (can I retrieve) (my account password?);\npublic <my_user_account?_80> = (can i close) (my user account?);\npublic <can_check_their_mone_49> = (can u ask an agent if i) (can check their money back guarantee?);\npublic <can_u_ask_an_agent_i_52> = (can u ask an agent if) (i could see the status of my refund);\npublic <can_you_find_informa_53> = (can you find information about) (the cancellation penalties?);\npublic <can_you_show_me_the__54> = (can you show me the mail of the Client Service?);\npublic <can_register_two_acc_50> = (can you tell me if I) (can register two accounts with the same email?);\npublic <I_can_create_several_9> = (can you tell me if) (I can create several accounts with the same email address?);\npublic <I_can_create_several_10> = (can you tell me if) (I can create several accounts with the same email?);\npublic <i_create_several_pro_58> = (can) (i create several profiles with the same email?);\npublic <could_you_ask_an_age_55> = (could you ask an agent where) (to inform of fucking problems with my payment?);\npublic <a_full_refund_in_cas_36> = (do I get) (a full refund in case) (I cancel my ticket?);\npublic <a_fucking_payment_pr_35> = (help me notify) (a fucking payment problem);\npublic <help_me_obtain_an_in_56> = (help me obtain an invoice);\npublic <an_order?_46> = (how can i make) (an order?);\npublic <I_obtain_a_reimburse_26> = (how can) (I obtain a reimbursement?);\npublic <i_notify_issues_payi_64> = (how could) (i notify issues paying?);\npublic <an_online_account_45> = (i dont have) (an online account);\npublic <i_attempted_to_make__57> = (i got an error when) (i attempted to make a payment);\npublic <i_got_an_error_when_59> = (i got an error when) (i tried to pay);\npublic <i_have_a_problem_mak_60> = (i have a problem making a payment with card);\npublic <i_have_an_issue_payi_61> = (i have an issue paying);\npublic <i_need_help_viewing__62> = (i need help viewing your payment methods);\npublic <i_need_information_63> = (i need information);\npublic <a_product_37> = (i obught) (a product);\npublic <i_wanna_check_66> = (i wanna check) (my delivery);\npublic <i_wanna_get_an_invoi_68> = (i wanna get an invoice);\npublic <i_wanna_get_67> = (i wanna get) (a refund);\npublic <i_wanna_know_how_soo_69> = (i wanna know how soon) (i can expect my tickets);\npublic <a_review_for_40> = (i wanna make) (a review for) (a service);\npublic <i_wanna_notify_an_is_70> = (i wanna notify an issue making a payment);\npublic <i_wanna_see_the_mail_71> = (i wanna see the mail of the Client Service);\npublic <i_wanna_track_72> = (i wanna track) (my purchase);\npublic <i_wannaq_obtai_a_rei_73> = (i wannaq obtai a reimbursement);\npublic <about_requesting_som_43> = (i want to get information) (about requesting some invoices);\npublic <a_user_account_41> = (i want) (a user account);\npublic <to_inform_of_an_issu_90> = (i want) (to inform of an issue paying);\npublic <to_know_what_the_mai_91> = (i want) (to know what the mail of the Client Service is);\npublic <want_infomration_95> = (i) (want infomration);\npublic <information_about_do_74> = (information about downloading an invoice);\npublic <to_request_some_invo_92> = (is it possible) (to request some invoices?);\npublic <my_online_account's__78> = (my online account's been hacked);\npublic <please_81> = (please);\npublic <please_82> = (please);\npublic <my_account_password_75> = (someone stole) (my account password);\npublic <I_can_create_more_th_8> = (tell me if) (I can create more than one online account with) (a single email address);\npublic <tell_me_what_the_mai_83> = (tell me what the mail address of) (the Customer Support is);\npublic <tell_me_where_84> = (tell me where) (I can check my deliveries);\npublic <the_event_was_postpo_85> = (the event was postponed);\npublic <the_fucking_concert__86> = (the fucking concert was postponed);\npublic <the_game_was_cancell_87> = (the game was cancelled);\npublic <a_review?_39> = (where do i write) (a review?);\npublic <I_notify_problems_pa_25> = (where do) (I notify problems paying?);\npublic <i_see_your_payment_o_65> = (where do) (i see your payment options?);\npublic <you_aren't_helping_96> = (you aren't helping);\npublic <you_arent_helping_an_98> = (you arent helping and i wanna talk) (to a human agent);\npublic <you_arent_helping_97> = (you arent helping);\npublic <your_not_helping_99> = (your not helping);\npublic <youre_not_helping_100> = (youre not helping);"},
		{name: "", args: args{f: "./data/tests/test5.csv"}, want: "#JSGF V1.0 ISO8859-1 en;\n\ngrammar main;\n\npublic <I_don't_have_an_onli> = (I don't have an online account);"},
		{name: "", args: args{f: "./data/tests/test6.csv"}, want: "#JSGF V1.0 ISO8859-1 en;\n\ngrammar main;\n\npublic <I_don't_have_an_onli> = (I don't have an online account);\npublic <I_don't_understand_y_1> = (I don't understand you);\npublic <I_got_an_error_messa_2> = (I got an error message when I attempted to make a payment);\npublic <I_want_an_online_acc_3> = (I want an online accoynt);\npublic <ask_an_agent_to_noti_4> = (ask an agent to notify issues with my payment);\npublic <can_you_show_me_info_5> = (can you show me information about the status of my refund?);\npublic <can_you_show_me_my_i_6> = (can you show me my invoices?);\npublic <can_you_tell_me_how__7> = (can you tell me how I can get some bills?);\npublic <i_dont_want_my_profi_8> = (i dont want my profile);\npublic <i_want_to_know_wat_t_9> = (i want to know wat the email of Customer Service is);\npublic <where_can_i_leave_an_10> = (where can i leave an opinion for a service?);"},
		{name: "", args: args{f: "./data/tests/test7.csv"}, want: emp},
		{name: "", args: args{f: "./data/tests/test8.csv"}, want: emp},
		{name: "", args: args{f: "./data/tests/test9.csv"}, want: "#JSGF V1.0 ISO8859-1 en;\n\ngrammar main;\n\npublic <I_don't_have_an_onli> = (I don't have an online account);\npublic <I_have_a_question_1> = (I have a question);\npublic <I_ordered_an_item_an_2> = (I ordered an item and Id like to modify my fucking order);\npublic <I_want_to_download_a_3> = (I want to download a bill);\npublic <I_want_to_know_what__4> = (I want to know what the number of Customer Service is);\npublic <I_want_to_make_a_rev_5> = (I want to make a review for a service);\npublic <how_do_I_make_change_6> = (how do I make changes to my shipping address?);\npublic <i_get_an_error_messa_7> = (i get an error message when i ty to make a payment for my order);\npublic <i_want_to_request_an_8> = (i want to request an invoice);\npublic <where_do_i_check_the_9> = (where do i check the delivery options?);\npublic <you_arent_helping_10> = (you arent helping);"},
		{name: "", args: args{f: "./data/tests/test10.csv"}, want: emp},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			file, _ := os.Open(tt.args.f)
			defer file.Close()
			s := bufio.NewScanner(file)
			tx := ReadTexts(s)
			c := NewCorpus(tx)
			c.transitions = NewTransitions(c, tk)
			c.ngrams = ToNgrams(c.texts, tk, c.transitions, 0.1)
			c.texts = SplitTriplets(c.texts, c.ngrams)
			rules := ToRules(c.texts)
			rules = SetIDs(rules)
			rules = ApplyFactor(rules)
			g := Grammar{Rules: rules}
			assert.Equal(t, tt.want, g.print())
		})
	}
}

func TestGrammar_printMain(t *testing.T) {
	var emp = "#JSGF V1.0 ISO8859-1 en;\n\ngrammar main;"
	var tk = NewUnigramTokenizer()

	type args struct {
		f string
	}
	tests := []struct {
		name string
		args args
		want string
	}{
		{name: "", args: args{f: "./data/tests/test1.csv"}, want: "#JSGF V1.0 ISO8859-1 en;\n\ngrammar main;\n\npublic <main> = (<I_don't_have_a_profi_8>|<I_don't_have_a_profi_9>|<I_don't_have_a_user__10>|<I_don't_have_an_onli_11>|<I_don't_have_7>|<I_have_no_account_12>|<I_have_no_fucking_ac_13>|<I_have_no_online_acc_14>|<I_have_no_user_accou_15>|<I_have_no_user_accou_16>|<I_haven't_got_a_prof_17>|<I_haven't_got_a_user_18>|<I_haven't_got_an_acc_19>|<I_haven't_got_an_onl_20>|<I_haven't_got_auser__21>|<I_need_a_user_accoun_22>|<I_need_an_account_an_24>|<I_need_an_account_23>|<I_need_an_online_acc_25>|<I_want_a_user_accoun_30>|<I_want_a_user_accoun_31>|<I_want_an_account_32>|<I_want_to_create_an__33>|<I_want_to_know_if_I__36>|<I_want_to_know_if_I__37>|<I_want_to_know_if_I__38>|<I_want_to_know_if_I__40>|<I_want_to_know_if_I__39>|<I_want_to_know_if_I__41>|<I_want_to_know_if_I__42>|<I_want_to_know_if_I__43>|<I_want_to_know_if_I_34>|<I_want_to_know_if_I_35>|<I_want_to_open_a_use_44>|<I_want_28>|<to_knoe_if_I_can_cre_80>|<to_nkow_if_I_can_reg_81>|<I_want_29>|<a_fucking_user_accou_45>|<I'd_like_a_user_acco>|<I've_got_no_account_1>|<I've_got_no_account_2>|<I've_got_no_profile_3>|<ask_an_agent_how_47>|<have_more_than_one_o_54>|<register?_76>|<can_you_tell_me_if_I_49>|<can_you_tell_me_if_I_50>|<can_you_tell_me_if_I_51>|<can_you_tell_me_if_i_52>|<can_regisger_two_acc_48>|<I_could_create_two_a_4>|<I_create_two_online__6>|<I_own_more_than_one__27>|<i_own_more_than_one__63>|<could_you_ask_an_age_53>|<I_create_an_online_a_5>|<I_open_an_online_acc_26>|<i_dont_have_a_profil_58>|<i_dont_have_a_user_a_59>|<i_dont_have_a_57>|<i_dont_have_an_onlin_60>|<i_dont_have_56>|<i_have_no_account_61>|<i_need_help_register_62>|<i_wanna_know_if_i_ca_64>|<i_wanna_know_if_i_ca_65>|<i_wanna_know_if_i_ca_66>|<i_want_a_profile_67>|<i_want_an_account_68>|<i_want_an_online_acc_69>|<i_want_to_create_an__70>|<i_want_to_know_if_i__72>|<i_want_to_know_if_i_71>|<i_could_create_two_p_55>|<i_watn_to_know_if_i__73>|<ive_got_no_online_ac_74>|<please_75>|<tell_me_if_I_can_cre_77>|<tell_me_if_I_can_reg_79>|<tell_me_if_I_can_reg_78>|<two_user_accounts_wi_82>|<an_onlind_account_46>);\n\n<I_don't_have_a_profi_8> = (I don't have a profile);\n<I_don't_have_a_profi_9> = (I don't have a profile);\n<I_don't_have_a_user__10> = (I don't have a user account);\n<I_don't_have_an_onli_11> = (I don't have an online account);\n<I_don't_have_7> = (I don't have) (a account);\n<I_have_no_account_12> = (I have no account);\n<I_have_no_fucking_ac_13> = (I have no fucking account);\n<I_have_no_online_acc_14> = (I have no online account);\n<I_have_no_user_accou_15> = (I have no user account);\n<I_have_no_user_accou_16> = (I have no user account);\n<I_haven't_got_a_prof_17> = (I haven't got a profile);\n<I_haven't_got_a_user_18> = (I haven't got a user account);\n<I_haven't_got_an_acc_19> = (I haven't got an account);\n<I_haven't_got_an_onl_20> = (I haven't got an online account);\n<I_haven't_got_auser__21> = (I haven't got auser account);\n<I_need_a_user_accoun_22> = (I need a user account and I want to) (create one);\n<I_need_an_account_an_24> = (I need an account and I want to open one);\n<I_need_an_account_23> = (I need an account);\n<I_need_an_online_acc_25> = (I need an online account);\n<I_want_a_user_accoun_30> = (I want a user account);\n<I_want_a_user_accoun_31> = (I want a user account);\n<I_want_an_account_32> = (I want an account);\n<I_want_to_create_an__33> = (I want to create an online account);\n<I_want_to_know_if_I__36> = (I want to know if I can create more than one account with a single email);\n<I_want_to_know_if_I__37> = (I want to know if I can create more than one account with the same email address);\n<I_want_to_know_if_I__38> = (I want to know if I can create more than one online account with a single email address);\n<I_want_to_know_if_I__40> = (I want to know if I can register more than one user account with a single email address);\n<I_want_to_know_if_I__39> = (I want to know if I can register more than one user account with a single email);\n<I_want_to_know_if_I__41> = (I want to know if I can register several profiles with the same email address);\n<I_want_to_know_if_I__42> = (I want to know if I can register several user accounts with the same email address);\n<I_want_to_know_if_I__43> = (I want to know if I can register two accounts with a single email address);\n<I_want_to_know_if_I_34> = (I want to know if I) (can have several accounts);\n<I_want_to_know_if_I_35> = (I want to know if I) (can own several accounts);\n<I_want_to_open_a_use_44> = (I want to open a user account);\n<I_want_28> = (I want) (a profille);\n<to_knoe_if_I_can_cre_80> = (I want) (to knoe if I can create two profiles) (with an single email address);\n<to_nkow_if_I_can_reg_81> = (I want) (to nkow if I can register two accounts with the same email);\n<I_want_29> = (I want) (to register);\n<a_fucking_user_accou_45> = (I would like) (a fucking user account);\n<I'd_like_a_user_acco> = (I'd like a user account);\n<I've_got_no_account_1> = (I've got no account);\n<I've_got_no_account_2> = (I've got no account);\n<I've_got_no_profile_3> = (I've got no profile);\n<ask_an_agent_how_47> = (ask an agent how) (i could create a user account);\n<have_more_than_one_o_54> = (can i) (have more than one online account?);\n<register?_76> = (can i) (register?);\n<can_you_tell_me_if_I_49> = (can you tell me if I can create more than one user account with the same email?);\n<can_you_tell_me_if_I_50> = (can you tell me if I can register several accounts with a single email address?);\n<can_you_tell_me_if_I_51> = (can you tell me if I can register several accounts with a single email?);\n<can_you_tell_me_if_i_52> = (can you tell me if i can create more than) (one fucking user account with the same email?);\n<can_regisger_two_acc_48> = (can you tell me if i) (can regisger two accounts with a single email address?);\n<I_could_create_two_a_4> = (can you tell me if) (I could create two accounts with a single email);\n<I_create_two_online__6> = (can) (I create two online accounts with a single email?);\n<I_own_more_than_one__27> = (can) (I own more than one account?);\n<i_own_more_than_one__63> = (can) (i own more than one online account?);\n<could_you_ask_an_age_53> = (could you ask an agent how to open an account);\n<I_create_an_online_a_5> = (how can) (I create an online account?);\n<I_open_an_online_acc_26> = (how can) (I open an online account?);\n<i_dont_have_a_profil_58> = (i dont have a profile);\n<i_dont_have_a_user_a_59> = (i dont have a user account and i want to open one);\n<i_dont_have_a_57> = (i dont have a) (user accolunt);\n<i_dont_have_an_onlin_60> = (i dont have an online account);\n<i_dont_have_56> = (i dont have) (a account);\n<i_have_no_account_61> = (i have no account);\n<i_need_help_register_62> = (i need help registering);\n<i_wanna_know_if_i_ca_64> = (i wanna know if i can create more than one user account with a single email address);\n<i_wanna_know_if_i_ca_65> = (i wanna know if i can create two online accounts with a single email address);\n<i_wanna_know_if_i_ca_66> = (i wanna know if i can register more) (than oneuser account with the same email);\n<i_want_a_profile_67> = (i want a profile);\n<i_want_an_account_68> = (i want an account);\n<i_want_an_online_acc_69> = (i want an online account);\n<i_want_to_create_an__70> = (i want to create an account);\n<i_want_to_know_if_i__72> = (i want to know if i can create two accounts with a single email address);\n<i_want_to_know_if_i_71> = (i want to know if i) (can have several accounts);\n<i_could_create_two_p_55> = (i want to know if) (i could create two profiles with the same email address);\n<i_watn_to_know_if_i__73> = (i watn to know if i can register two profiles with the same email address);\n<ive_got_no_online_ac_74> = (ive got no online account);\n<please_75> = (please);\n<tell_me_if_I_can_cre_77> = (tell me if I can create two online accounts with the same email);\n<tell_me_if_I_can_reg_79> = (tell me if I can register two accounts with a single email address);\n<tell_me_if_I_can_reg_78> = (tell me if I can register two online accounts with the same email);\n<two_user_accounts_wi_82> = (tell me if I could register) (two user accounts with a single email address);\n<an_onlind_account_46> = (were to create) (an onlind account);"},
		{name: "", args: args{f: "./data/tests/test2.csv"}, want: "#JSGF V1.0 ISO8859-1 en;\n\ngrammar main;\n\npublic <main> = (<I_acn't_understand_y>|<I_ahve_a_problem_whe_1>|<I_ahve_an_issue_when_2>|<I_ahve_no_account_3>|<I_am_discontent_with_5>|<I_am_discontent_with_4>|<I_am_happy_with_the__10>|<I_am_happy_with_the__9>|<I_am_happy_with_the__7>|<I_am_happy_with_the__8>|<I_am_happy_with_the__6>|<I_am_interested_in_t_11>|<I_am_interested_in_y_12>|<I_am_interested_in_y_13>|<I_am_not_happy_with__15>|<I_am_not_happy_with__14>|<I_ant_to_know_what_16>|<to_ask_for_informati_44>|<to_notify_problems_m_46>|<to_recover_my_passwo_47>|<I_awnna_know_somethi_17>|<I_boguht_a_product_18>|<I_bought_a_product_a_24>|<I_bought_a_product_a_25>|<I_bought_a_product_a_26>|<I_bought_a_product_a_22>|<I_bought_a_product_a_23>|<I_bought_a_product_20>|<I_bought_a_product_21>|<I_bought_an_item_27>|<I_bought_19>|<I_don't_have_an_onli_30>|<I_forgot_my_password_31>|<I_found_an_issue_ope_32>|<I_have_a_problem_whe_34>|<I_have_a_problem_whe_33>|<I_have_no_user_accou_35>|<I_need_help_informin_36>|<I_ordered_something_37>|<I_can_know_where_my__29>|<I_can_create_several_28>|<the_hours_of_Custome_42>|<the_status_of_my_ord_43>|<to_remove_my_online__48>|<to_track_my_deliveri_50>|<to_view_your_payment_51>|<a_question_38>|<a_user_account_39>|<need_ehlp_modifying_40>|<need_help_informing__41>|<to_check_your_money__45>|<want_to_know_if_52>|<to_request_some_bill_49>);\n\n<I_acn't_understand_y> = (I acn't understand you);\n<I_ahve_a_problem_whe_1> = (I ahve a problem when trying to pay for my online order);\n<I_ahve_an_issue_when_2> = (I ahve an issue when trying) (to make a payment);\n<I_ahve_no_account_3> = (I ahve no account);\n<I_am_discontent_with_5> = (I am discontent with the service and I want) (to submit a consumer complaint);\n<I_am_discontent_with_4> = (I am discontent with the service);\n<I_am_happy_with_the__10> = (I am happy with the service and I'd like tro submit an opinion);\n<I_am_happy_with_the__9> = (I am happy with the service and I'd like) (to lodge a review);\n<I_am_happy_with_the__7> = (I am happy with the service and) (I would like to make an opinion);\n<I_am_happy_with_the__8> = (I am happy with the service and) (I would like to submit an opinion);\n<I_am_happy_with_the__6> = (I am happy with the service);\n<I_am_interested_in_t_11> = (I am interested in their fucking money back guarantee);\n<I_am_interested_in_y_12> = (I am interested in your fucking refund policy and I want to know about it);\n<I_am_interested_in_y_13> = (I am interested in your fucking reimbursement policy);\n<I_am_not_happy_with__15> = (I am not happy with the service and I want) (to lodge a complaint);\n<I_am_not_happy_with__14> = (I am not happy with the service);\n<I_ant_to_know_what_16> = (I ant to know what) (the mail address of the Customer Support is);\n<to_ask_for_informati_44> = (I ant) (to ask for information about modifying my purchase);\n<to_notify_problems_m_46> = (I ant) (to notify problems making a payment);\n<to_recover_my_passwo_47> = (I ant) (to recover my password);\n<I_awnna_know_somethi_17> = (I awnna know something about seeing an invoice);\n<I_boguht_a_product_18> = (I boguht a product);\n<I_bought_a_product_a_24> = (I bought a product and I want) (to change my purchase);\n<I_bought_a_product_a_25> = (I bought a product and I want) (to modify my order);\n<I_bought_a_product_a_26> = (I bought a product and I want) (to modify my purchase);\n<I_bought_a_product_a_22> = (I bought a product and) (I wanna change my purchase);\n<I_bought_a_product_a_23> = (I bought a product and) (I wanna modify my order);\n<I_bought_a_product_20> = (I bought a product);\n<I_bought_a_product_21> = (I bought a product);\n<I_bought_an_item_27> = (I bought an item);\n<I_bought_19> = (I bought) (a prodjct);\n<I_don't_have_an_onli_30> = (I don't have an online account);\n<I_forgot_my_password_31> = (I forgot my password and I want) (to retrieve it);\n<I_found_an_issue_ope_32> = (I found an issue opening an account);\n<I_have_a_problem_whe_34> = (I have a problem when trying to pay for my online order and) (I ant to notify it);\n<I_have_a_problem_whe_33> = (I have a problem when trying to pay);\n<I_have_no_user_accou_35> = (I have no user account);\n<I_need_help_informin_36> = (I need help informing of problems) (with my payment);\n<I_ordered_something_37> = (I ordered something);\n<I_can_know_where_my__29> = (I want to know how) (I can know where my deliveries are);\n<I_can_create_several_28> = (I want to know if) (I can create several profiles with) (the same email);\n<the_hours_of_Custome_42> = (I want to know what) (the hours of Customer Service are);\n<the_status_of_my_ord_43> = (I want to see) (the status of my order);\n<to_remove_my_online__48> = (I want) (to remove my online account);\n<to_track_my_deliveri_50> = (I want) (to track my deliveries);\n<to_view_your_payment_51> = (I want) (to view your payment options);\n<a_question_38> = (have) (a question);\n<a_user_account_39> = (havent got) (a user account) (and i wannaregister);\n<need_ehlp_modifying_40> = (need ehlp modifying) (my profile);\n<need_help_informing__41> = (need help informing of issues paying);\n<to_check_your_money__45> = (wan) (to check your money back guarantee);\n<want_to_know_if_52> = (want to know if) (I can track my shipments);\n<to_request_some_bill_49> = (want) (to request some bills);"},
		{name: "", args: args{f: "./data/tests/test3.csv"}, want: "#JSGF V1.0 ISO8859-1 en;\n\ngrammar main;\n\npublic <main> = (<I_acn't_understand_y>|<I_ahve_a_problem_whe_1>|<I_ahve_an_issue_when_2>|<I_ahve_no_account_3>|<I_am_discontent_with_5>|<I_am_discontent_with_4>|<I_am_happy_with_the__7>|<I_am_happy_with_the__8>|<I_am_happy_with_the__9>|<and_I'd_like_tro_sub_75>|<I_am_happy_with_the__6>|<I_am_interested_in_t_10>|<I_am_interested_in_y_11>|<I_am_interested_in_y_12>|<I_am_not_happy_with__14>|<I_am_not_happy_with__13>|<I_ant_to_know_what_16>|<to_ask_for_informati_96>|<to_notify_problems_m_98>|<I_ant_15>|<I_awnna_know_somethi_17>|<I_boguht_a_product_18>|<I_bought_a_product_a_25>|<I_bought_a_product_a_26>|<I_bought_a_product_a_27>|<I_bought_a_product_a_23>|<I_bought_a_product_a_24>|<I_bought_a_product_21>|<I_bought_a_product_22>|<I_bought_an_item_and_30>|<I_bought_an_item_and_31>|<I_bought_an_item_and_32>|<I_bought_an_item_and_33>|<and_i'd_like_to_modi_77>|<I_bought_an_item_28>|<I_bought_an_item_29>|<I_bought_something_a_35>|<I_bought_something_a_36>|<I_bought_something_a_37>|<I_wanna_change_my_pu_66>|<and_Id_like_to_chang_76>|<and_want_to_modify_m_78>|<I_bought_something_34>|<I_bought_19>|<I_bought_20>|<I_bougyt_an_item_38>|<I_bouvht_a_product_a_39>|<I_ca't_remember_40>|<my_fucking_password__86>|<a_profile_71>|<my_invoices_87>|<my_bills_82>|<I_can't_find_my_bill_51>|<I_can't_find_my_bill_49>|<I_can't_find_my_bill_50>|<and_I'd_like_to_view_74>|<I_can't_find_my_bill_47>|<I_can't_find_my_bill_48>|<I_would_like_to_view_70>|<I_can't_find_my_invo_56>|<I_can't_find_my_invo_55>|<I_can't_find_my_invo_57>|<I_can't_find_my_invo_52>|<I_can't_find_my_invo_53>|<I_can't_find_my_invo_54>|<my_bills_and_I_want__84>|<my_bills_and_I_want_83>|<I_can't_find_41>|<I_can't_find_42>|<my_bklls_and_I_want_85>|<I_can't_find_43>|<I_can't_find_44>|<my_invoices_and_I_wa_88>|<my_invoices_and_I_wa_89>|<I_can't_find_45>|<I_can't_find_46>|<I_don't_have_59>|<my_password_and_I_wa_91>|<I_found_an_issue_ope_60>|<I_have_a_problem_whe_62>|<I_have_a_problem_whe_61>|<I_have_no_user_accou_63>|<I_need_help_informin_64>|<I_ordered_something_65>|<I_want_to_know_how_68>|<I_can_create_several_58>|<the_hours_of_Custome_94>|<my_online_account_90>|<the_status_of_my_ord_95>|<I_want_to_view_your__69>|<I_want_67>|<bought_na_item_79>|<bought_somethikng_80>|<can't_understand_you_81>|<a_question_72>|<a_user_account_73>|<need_ehlp_modifying_92>|<need_help_informing__93>|<to_check_your_money__97>|<want_to_know_if_100>|<to_request_some_bill_99>);\n\n<I_acn't_understand_y> = (I acn't understand you);\n<I_ahve_a_problem_whe_1> = (I ahve a problem when trying) (to pay for my online order);\n<I_ahve_an_issue_when_2> = (I ahve an issue when trying) (to make a payment);\n<I_ahve_no_account_3> = (I ahve no account);\n<I_am_discontent_with_5> = (I am discontent with the service and I want) (to submit a consumer complaint);\n<I_am_discontent_with_4> = (I am discontent with the service);\n<I_am_happy_with_the__7> = (I am happy with the service and) (I would like to make an opinion);\n<I_am_happy_with_the__8> = (I am happy with the service and) (I would like to submit an opinion);\n<I_am_happy_with_the__9> = (I am happy with the service) (and I'd like to lodge a review);\n<and_I'd_like_tro_sub_75> = (I am happy with the service) (and I'd like tro submit an opinion);\n<I_am_happy_with_the__6> = (I am happy with the service);\n<I_am_interested_in_t_10> = (I am interested in their fucking money back guarantee);\n<I_am_interested_in_y_11> = (I am interested in your fucking refund policy and I want to know about it);\n<I_am_interested_in_y_12> = (I am interested in your fucking reimbursement policy);\n<I_am_not_happy_with__14> = (I am not happy with the service and I want) (to lodge a complaint);\n<I_am_not_happy_with__13> = (I am not happy with the service);\n<I_ant_to_know_what_16> = (I ant to know what) (the mail address of the Customer Support is);\n<to_ask_for_informati_96> = (I ant) (to ask for information about modifying my purchase);\n<to_notify_problems_m_98> = (I ant) (to notify problems making) (a payment);\n<I_ant_15> = (I ant) (to recover my password);\n<I_awnna_know_somethi_17> = (I awnna know something about seeing) (an invoice);\n<I_boguht_a_product_18> = (I boguht a product);\n<I_bought_a_product_a_25> = (I bought a product and I want to change my purchase);\n<I_bought_a_product_a_26> = (I bought a product and I want to modify my order);\n<I_bought_a_product_a_27> = (I bought a product and I want to modify my purchase);\n<I_bought_a_product_a_23> = (I bought a product and) (I wanna change my purchase);\n<I_bought_a_product_a_24> = (I bought a product and) (I wanna modify my order);\n<I_bought_a_product_21> = (I bought a product);\n<I_bought_a_product_22> = (I bought a product);\n<I_bought_an_item_and_30> = (I bought an item and I want to change my order);\n<I_bought_an_item_and_31> = (I bought an item and I want to change my purchase);\n<I_bought_an_item_and_32> = (I bought an item and I want to modify my order);\n<I_bought_an_item_and_33> = (I bought an item ands I want to modify my purchase);\n<and_i'd_like_to_modi_77> = (I bought an item) (and i'd like to modify my order);\n<I_bought_an_item_28> = (I bought an item);\n<I_bought_an_item_29> = (I bought an item);\n<I_bought_something_a_35> = (I bought something and I want to change my order);\n<I_bought_something_a_36> = (I bought something and I want to change my purchase);\n<I_bought_something_a_37> = (I bought something and I want to modify my order);\n<I_wanna_change_my_pu_66> = (I bought something and) (I wanna change my purchase);\n<and_Id_like_to_chang_76> = (I bought something) (and Id like to change my purchase);\n<and_want_to_modify_m_78> = (I bought something) (and want to modify my purchase);\n<I_bought_something_34> = (I bought something);\n<I_bought_19> = (I bought) (a prodjct);\n<I_bought_20> = (I bought) (an product);\n<I_bougyt_an_item_38> = (I bougyt an item);\n<I_bouvht_a_product_a_39> = (I bouvht a product and I want to change my order);\n<I_ca't_remember_40> = (I ca't remember) (my password);\n<my_fucking_password__86> = (I can' remember) (my fucking password and) (I would like to reset it);\n<a_profile_71> = (I can't create) (a profile);\n<my_invoices_87> = (I can't dind) (my invoices);\n<my_bills_82> = (I can't fidn) (my bills);\n<I_can't_find_my_bill_51> = (I can't find my bill and I want to view it);\n<I_can't_find_my_bill_49> = (I can't find my bill and I want) (to check it);\n<I_can't_find_my_bill_50> = (I can't find my bill and I want) (to see it);\n<and_I'd_like_to_view_74> = (I can't find my bill) (and I'd like to view it);\n<I_can't_find_my_bill_47> = (I can't find my bill);\n<I_can't_find_my_bill_48> = (I can't find my bill);\n<I_would_like_to_view_70> = (I can't find my fucking invoices and) (I would like to view them);\n<I_can't_find_my_invo_56> = (I can't find my invoice and I want to view it);\n<I_can't_find_my_invo_55> = (I can't find my invoice and I want) (to check it);\n<I_can't_find_my_invo_57> = (I can't find my invoice andI want) (to see it);\n<I_can't_find_my_invo_52> = (I can't find my invoice);\n<I_can't_find_my_invo_53> = (I can't find my invoice);\n<I_can't_find_my_invo_54> = (I can't find my invoice);\n<my_bills_and_I_want__84> = (<I_can't_find>) (my bills and I want to view them);\n<my_bills_and_I_want_83> = (<I_can't_find>) (my bills and I want) (to see them);\n<I_can't_find_41> = (<I_can't_find>) (my bills);\n<I_can't_find_42> = (<I_can't_find>) (my bills);\n<my_bklls_and_I_want_85> = (<I_can't_find>) (my bklls and I want) (to check them);\n<I_can't_find_43> = (<I_can't_find>) (my fucking bills);\n<I_can't_find_44> = (<I_can't_find>) (my fucking invoice);\n<my_invoices_and_I_wa_88> = (<I_can't_find>) (my invoices and I want) (to check them);\n<my_invoices_and_I_wa_89> = (<I_can't_find>) (my invoices and I want) (to see them);\n<I_can't_find_45> = (<I_can't_find>) (my invoices);\n<I_can't_find_46> = (<I_can't_find>) (my invoices);\n<I_don't_have_59> = (I don't have) (an online account);\n<my_password_and_I_wa_91> = (I forgot) (my password and I want) (to retrieve it);\n<I_found_an_issue_ope_60> = (I found an issue opening) (an account);\n<I_have_a_problem_whe_62> = (I have a problem when trying) (to pay for my online order and I ant to notify it);\n<I_have_a_problem_whe_61> = (I have a problem when trying) (to pay);\n<I_have_no_user_accou_63> = (I have no user account);\n<I_need_help_informin_64> = (I need help informing of problems) (with my payment);\n<I_ordered_something_65> = (I ordered something);\n<I_want_to_know_how_68> = (I want to know how) (I can know where my deliveries are);\n<I_can_create_several_58> = (I want to know if) (I can create several profiles with) (the same email);\n<the_hours_of_Custome_94> = (I want to know what) (the hours of Customer Service are);\n<my_online_account_90> = (I want to remove) (my online account);\n<the_status_of_my_ord_95> = (I want to see) (the status of my order);\n<I_want_to_view_your__69> = (I want to view your payment options);\n<I_want_67> = (I want) (to track my deliveries);\n<bought_na_item_79> = (I) (bought na item);\n<bought_somethikng_80> = (I) (bought somethikng);\n<can't_understand_you_81> = (I) (can't understand you);\n<a_question_72> = (have) (a question);\n<a_user_account_73> = (havent got) (a user account) (and i wannaregister);\n<need_ehlp_modifying_92> = (need ehlp modifying) (my profile);\n<need_help_informing__93> = (need help informing of issues paying);\n<to_check_your_money__97> = (wan) (to check your money back guarantee);\n<want_to_know_if_100> = (want to know if) (I can track my shipments);\n<to_request_some_bill_99> = (want) (to request some bills);\n<I_can't_find> = (I can't find);"},
		{name: "", args: args{f: "./data/tests/test4.csv"}, want: "#JSGF V1.0 ISO8859-1 en;\n\ngrammar main;\n\npublic <main> = (<I_bought_3>|<I_can't_find_4>|<I_can't_find_5>|<my_invoice_and_I_wan_77>|<I_can't_find_6>|<I_can't_remember_7>|<I_changed_11>|<I_didn't_receive_12>|<an_online_account_44>|<I_don't_know_anythin_13>|<I_don't_know_anythin_14>|<I_don't_know_anythin_15>|<I_get_an_error_when_16>|<I_attempted_to_pay_2>|<I_attempted_to_make__1>|<I_have_a_problem_whe_17>|<I_have_a_problem_whe_18>|<I_have_a_problem_whe_19>|<I_have_an_issue_maki_20>|<I_have_an_issue_payi_21>|<I_have_no_shipping_a_22>|<I_need_help_viewing_23>|<I_need_information_24>|<I_want_a_reimburseme_30>|<about_obtaining_an_i_42>|<to_change_my_order_88>|<I_want_to_make_31>|<I_want_to_make_32>|<my_other_account_79>|<I_want_to_view_cance_33>|<I_want_to_view_your__34>|<I_want_28>|<to_get_information_a_89>|<I_want_29>|<to_see_the_status_of_93>|<I'm_happy_wiht>|<I_try_to_pay_for_my__27>|<ask_an_agent_how_47>|<ask_an_agent_how_48>|<can_report_an_issue__51>|<to_show_me_informati_94>|<a_purchase?_38>|<my_account_password?_76>|<my_user_account?_80>|<can_check_their_mone_49>|<can_u_ask_an_agent_i_52>|<can_you_find_informa_53>|<can_you_show_me_the__54>|<can_register_two_acc_50>|<I_can_create_several_9>|<I_can_create_several_10>|<i_create_several_pro_58>|<could_you_ask_an_age_55>|<a_full_refund_in_cas_36>|<a_fucking_payment_pr_35>|<help_me_obtain_an_in_56>|<an_order?_46>|<I_obtain_a_reimburse_26>|<i_notify_issues_payi_64>|<an_online_account_45>|<i_attempted_to_make__57>|<i_got_an_error_when_59>|<i_have_a_problem_mak_60>|<i_have_an_issue_payi_61>|<i_need_help_viewing__62>|<i_need_information_63>|<a_product_37>|<i_wanna_check_66>|<i_wanna_get_an_invoi_68>|<i_wanna_get_67>|<i_wanna_know_how_soo_69>|<a_review_for_40>|<i_wanna_notify_an_is_70>|<i_wanna_see_the_mail_71>|<i_wanna_track_72>|<i_wannaq_obtai_a_rei_73>|<about_requesting_som_43>|<a_user_account_41>|<to_inform_of_an_issu_90>|<to_know_what_the_mai_91>|<want_infomration_95>|<information_about_do_74>|<to_request_some_invo_92>|<my_online_account's__78>|<please_81>|<please_82>|<my_account_password_75>|<I_can_create_more_th_8>|<tell_me_what_the_mai_83>|<tell_me_where_84>|<the_event_was_postpo_85>|<the_fucking_concert__86>|<the_game_was_cancell_87>|<a_review?_39>|<I_notify_problems_pa_25>|<i_see_your_payment_o_65>|<you_aren't_helping_96>|<you_arent_helping_an_98>|<you_arent_helping_97>|<your_not_helping_99>|<youre_not_helping_100>);\n\n<I_bought_3> = (I bought) (an item);\n<I_can't_find_4> = (I can't find) (my bill);\n<I_can't_find_5> = (I can't find) (my bills);\n<my_invoice_and_I_wan_77> = (I can't find) (my invoice and I want to view it);\n<I_can't_find_6> = (I can't find) (my invoice);\n<I_can't_remember_7> = (I can't remember) (my passwprd);\n<I_changed_11> = (I changed) (my mind);\n<I_didn't_receive_12> = (I didn't receive) (my invoices);\n<an_online_account_44> = (I don't have) (an online account);\n<I_don't_know_anythin_13> = (I don't know anything about your money back guarantee and I want information about it);\n<I_don't_know_anythin_14> = (I don't know anything about your money back policy and I want information about it);\n<I_don't_know_anythin_15> = (I don't know anything about your refund policy);\n<I_get_an_error_when_16> = (I get an error when) (I attempt to pay);\n<I_attempted_to_pay_2> = (I got an erreor when) (I attempted to pay);\n<I_attempted_to_make__1> = (I got an error message when) (I attempted to make a payment);\n<I_have_a_problem_whe_17> = (I have a problem when trying ot make a payment with card);\n<I_have_a_problem_whe_18> = (I have a problem when trying to make a payment);\n<I_have_a_problem_whe_19> = (I have a problem when trying to pay);\n<I_have_an_issue_maki_20> = (I have an issue making) (a paymet);\n<I_have_an_issue_payi_21> = (I have an issue paying for my order);\n<I_have_no_shipping_a_22> = (I have no shipping address);\n<I_need_help_viewing_23> = (I need help viewing) (my bills);\n<I_need_information_24> = (I need information);\n<I_want_a_reimburseme_30> = (I want a reimbursement);\n<about_obtaining_an_i_42> = (I want to ask for information) (about obtaining an invoice);\n<to_change_my_order_88> = (I want to know how) (to change my order);\n<I_want_to_make_31> = (I want to make) (a comment);\n<I_want_to_make_32> = (I want to make) (a complaint for a service);\n<my_other_account_79> = (I want to use) (my other account);\n<I_want_to_view_cance_33> = (I want to view cancellation penalties);\n<I_want_to_view_your__34> = (I want to view your reimbursement policy);\n<I_want_28> = (I want) (to download a bill);\n<to_get_information_a_89> = (I want) (to get information about downloading some invoices);\n<I_want_29> = (I want) (to submit a complaint);\n<to_see_the_status_of_93> = (I'd like) (to see the status of my order);\n<I'm_happy_wiht> = (I'm happy wiht) (the service);\n<I_try_to_pay_for_my__27> = (an error message pops when) (I try to pay for my order);\n<ask_an_agent_how_47> = (ask an agent how) (to file an consumer complaint);\n<ask_an_agent_how_48> = (ask an agent how) (to modufy my purchase);\n<can_report_an_issue__51> = (ask an agent where i) (can report an issue paying);\n<to_show_me_informati_94> = (ask an agent) (to show me information about) (the delivery period);\n<a_purchase?_38> = (can I cancel) (a purchase?);\n<my_account_password?_76> = (can I retrieve) (my account password?);\n<my_user_account?_80> = (can i close) (my user account?);\n<can_check_their_mone_49> = (can u ask an agent if i) (can check their money back guarantee?);\n<can_u_ask_an_agent_i_52> = (can u ask an agent if) (i could see the status of my refund);\n<can_you_find_informa_53> = (can you find information about) (the cancellation penalties?);\n<can_you_show_me_the__54> = (can you show me the mail of the Client Service?);\n<can_register_two_acc_50> = (can you tell me if I) (can register two accounts with the same email?);\n<I_can_create_several_9> = (can you tell me if) (I can create several accounts with the same email address?);\n<I_can_create_several_10> = (can you tell me if) (I can create several accounts with the same email?);\n<i_create_several_pro_58> = (can) (i create several profiles with the same email?);\n<could_you_ask_an_age_55> = (could you ask an agent where) (to inform of fucking problems with my payment?);\n<a_full_refund_in_cas_36> = (do I get) (a full refund in case) (I cancel my ticket?);\n<a_fucking_payment_pr_35> = (help me notify) (a fucking payment problem);\n<help_me_obtain_an_in_56> = (help me obtain an invoice);\n<an_order?_46> = (how can i make) (an order?);\n<I_obtain_a_reimburse_26> = (how can) (I obtain a reimbursement?);\n<i_notify_issues_payi_64> = (how could) (i notify issues paying?);\n<an_online_account_45> = (i dont have) (an online account);\n<i_attempted_to_make__57> = (i got an error when) (i attempted to make a payment);\n<i_got_an_error_when_59> = (i got an error when) (i tried to pay);\n<i_have_a_problem_mak_60> = (i have a problem making a payment with card);\n<i_have_an_issue_payi_61> = (i have an issue paying);\n<i_need_help_viewing__62> = (i need help viewing your payment methods);\n<i_need_information_63> = (i need information);\n<a_product_37> = (i obught) (a product);\n<i_wanna_check_66> = (i wanna check) (my delivery);\n<i_wanna_get_an_invoi_68> = (i wanna get an invoice);\n<i_wanna_get_67> = (i wanna get) (a refund);\n<i_wanna_know_how_soo_69> = (i wanna know how soon) (i can expect my tickets);\n<a_review_for_40> = (i wanna make) (a review for) (a service);\n<i_wanna_notify_an_is_70> = (i wanna notify an issue making a payment);\n<i_wanna_see_the_mail_71> = (i wanna see the mail of the Client Service);\n<i_wanna_track_72> = (i wanna track) (my purchase);\n<i_wannaq_obtai_a_rei_73> = (i wannaq obtai a reimbursement);\n<about_requesting_som_43> = (i want to get information) (about requesting some invoices);\n<a_user_account_41> = (i want) (a user account);\n<to_inform_of_an_issu_90> = (i want) (to inform of an issue paying);\n<to_know_what_the_mai_91> = (i want) (to know what the mail of the Client Service is);\n<want_infomration_95> = (i) (want infomration);\n<information_about_do_74> = (information about downloading an invoice);\n<to_request_some_invo_92> = (is it possible) (to request some invoices?);\n<my_online_account's__78> = (my online account's been hacked);\n<please_81> = (please);\n<please_82> = (please);\n<my_account_password_75> = (someone stole) (my account password);\n<I_can_create_more_th_8> = (tell me if) (I can create more than one online account with) (a single email address);\n<tell_me_what_the_mai_83> = (tell me what the mail address of) (the Customer Support is);\n<tell_me_where_84> = (tell me where) (I can check my deliveries);\n<the_event_was_postpo_85> = (the event was postponed);\n<the_fucking_concert__86> = (the fucking concert was postponed);\n<the_game_was_cancell_87> = (the game was cancelled);\n<a_review?_39> = (where do i write) (a review?);\n<I_notify_problems_pa_25> = (where do) (I notify problems paying?);\n<i_see_your_payment_o_65> = (where do) (i see your payment options?);\n<you_aren't_helping_96> = (you aren't helping);\n<you_arent_helping_an_98> = (you arent helping and i wanna talk) (to a human agent);\n<you_arent_helping_97> = (you arent helping);\n<your_not_helping_99> = (your not helping);\n<youre_not_helping_100> = (youre not helping);"},
		{name: "", args: args{f: "./data/tests/test5.csv"}, want: "#JSGF V1.0 ISO8859-1 en;\n\ngrammar main;\n\npublic <main> = (<I_don't_have_an_onli>);\n\n<I_don't_have_an_onli> = (I don't have an online account);"},
		{name: "", args: args{f: "./data/tests/test6.csv"}, want: "#JSGF V1.0 ISO8859-1 en;\n\ngrammar main;\n\npublic <main> = (<I_don't_have_an_onli>|<I_don't_understand_y_1>|<I_got_an_error_messa_2>|<I_want_an_online_acc_3>|<ask_an_agent_to_noti_4>|<can_you_show_me_info_5>|<can_you_show_me_my_i_6>|<can_you_tell_me_how__7>|<i_dont_want_my_profi_8>|<i_want_to_know_wat_t_9>|<where_can_i_leave_an_10>);\n\n<I_don't_have_an_onli> = (I don't have an online account);\n<I_don't_understand_y_1> = (I don't understand you);\n<I_got_an_error_messa_2> = (I got an error message when I attempted to make a payment);\n<I_want_an_online_acc_3> = (I want an online accoynt);\n<ask_an_agent_to_noti_4> = (ask an agent to notify issues with my payment);\n<can_you_show_me_info_5> = (can you show me information about the status of my refund?);\n<can_you_show_me_my_i_6> = (can you show me my invoices?);\n<can_you_tell_me_how__7> = (can you tell me how I can get some bills?);\n<i_dont_want_my_profi_8> = (i dont want my profile);\n<i_want_to_know_wat_t_9> = (i want to know wat the email of Customer Service is);\n<where_can_i_leave_an_10> = (where can i leave an opinion for a service?);"},
		{name: "", args: args{f: "./data/tests/test7.csv"}, want: emp},
		{name: "", args: args{f: "./data/tests/test8.csv"}, want: emp},
		{name: "", args: args{f: "./data/tests/test9.csv"}, want: "#JSGF V1.0 ISO8859-1 en;\n\ngrammar main;\n\npublic <main> = (<I_don't_have_an_onli>|<I_have_a_question_1>|<I_ordered_an_item_an_2>|<I_want_to_download_a_3>|<I_want_to_know_what__4>|<I_want_to_make_a_rev_5>|<how_do_I_make_change_6>|<i_get_an_error_messa_7>|<i_want_to_request_an_8>|<where_do_i_check_the_9>|<you_arent_helping_10>);\n\n<I_don't_have_an_onli> = (I don't have an online account);\n<I_have_a_question_1> = (I have a question);\n<I_ordered_an_item_an_2> = (I ordered an item and Id like to modify my fucking order);\n<I_want_to_download_a_3> = (I want to download a bill);\n<I_want_to_know_what__4> = (I want to know what the number of Customer Service is);\n<I_want_to_make_a_rev_5> = (I want to make a review for a service);\n<how_do_I_make_change_6> = (how do I make changes to my shipping address?);\n<i_get_an_error_messa_7> = (i get an error message when i ty to make a payment for my order);\n<i_want_to_request_an_8> = (i want to request an invoice);\n<where_do_i_check_the_9> = (where do i check the delivery options?);\n<you_arent_helping_10> = (you arent helping);"},
		{name: "", args: args{f: "./data/tests/test10.csv"}, want: emp},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			file, _ := os.Open(tt.args.f)
			defer file.Close()
			s := bufio.NewScanner(file)
			tx := ReadTexts(s)
			c := NewCorpus(tx)
			c.transitions = NewTransitions(c, tk)
			c.ngrams = ToNgrams(c.texts, tk, c.transitions, 0.1)
			c.texts = SplitTriplets(c.texts, c.ngrams)
			rules := ToRules(c.texts)
			rules = SetIDs(rules)
			rules = ApplyFactor(rules)
			g := Grammar{Rules: rules}
			assert.Equal(t, tt.want, g.printMain())
		})
	}
}

func TestGrammarProductionsE2E(t *testing.T) {
	var tk = NewUnigramTokenizer()
	var ssd SSDMerger
	var sds SDSMerger
	var dss DSSMerger
	var sss SSSMerger
	var mergers = []RuleMerger{&dss, &sds, &ssd, &sss}
	var perms [][]int
	for i := range 4 {
		perms = append(perms, combin.Permutations(4, i+1)...)
	}

	type args struct {
		f string
	}
	tests := []struct {
		name string
		args args
	}{
		{name: "", args: args{f: "./data/tests/test1.csv"}},
		{name: "", args: args{f: "./data/tests/test2.csv"}},
		{name: "", args: args{f: "./data/tests/test3.csv"}},
		{name: "", args: args{f: "./data/tests/test4.csv"}},
		{name: "", args: args{f: "./data/tests/test5.csv"}},
		{name: "", args: args{f: "./data/tests/test6.csv"}},
		{name: "", args: args{f: "./data/tests/test7.csv"}},
		{name: "", args: args{f: "./data/tests/test8.csv"}},
		{name: "", args: args{f: "./data/tests/test9.csv"}},
		{name: "", args: args{f: "./data/tests/test10.csv"}},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			file, _ := os.Open(tt.args.f)
			defer file.Close()
			s := bufio.NewScanner(file)
			tx := ReadTexts(s)
			for i := range tx {
				tx[i] = strings.TrimSpace(strings.Replace(tx[i], "  ", " ", -1))
				tx[i] = joinBoundaries(tx[i])
			}
			tx = slices.DeleteFunc(tx, func(i string) bool { return i == "" })
			slices.Sort(tx)
			tx = slices.Compact(tx)
			c := NewCorpus(tx)
			c.transitions = NewTransitions(c, tk)
			c.ngrams = ToNgrams(c.texts, tk, c.transitions, 0.1)
			c.texts = SplitTriplets(c.texts, c.ngrams)
			rules := ToRules(c.texts)

			for _, p := range perms {
				rules1 := rules
				for _, pp := range p {
					rules1 = mergers[pp].apply(rules)
				}
				rules1 = SetIDs(rules1)
				rules1 = ApplyFactor(rules1)
				g := Grammar{Rules: rules1}
				os.WriteFile("./data/tests/out/tmp.jsgf", []byte(g.print()), 0644)
				exec.Command("./data/tests/out/gsgf", "generate", "./data/tests/out/tmp.jsgf", "-o", "./data/tests/out/out.txt").Run()
				file, _ = os.Open("./data/tests/out/out.txt")
				defer file.Close()
				s = bufio.NewScanner(file)
				txx := ReadTexts(s)
				slices.Sort(txx)
				txx = slices.Compact(txx)
				assert.ElementsMatch(t, tx, txx)
			}
		})
	}
}

func TestGrammarProductionsMainE2E(t *testing.T) {
	var tk = NewUnigramTokenizer()
	var ssd SSDMerger
	var sds SDSMerger
	var dss DSSMerger
	var sss SSSMerger
	var mergers = []RuleMerger{&dss, &sds, &ssd, &sss}
	var perms [][]int
	for i := range 4 {
		perms = append(perms, combin.Permutations(4, i+1)...)
	}

	type args struct {
		f string
	}
	tests := []struct {
		name string
		args args
	}{
		{name: "", args: args{f: "./data/tests/test1.csv"}},
		{name: "", args: args{f: "./data/tests/test2.csv"}},
		{name: "", args: args{f: "./data/tests/test3.csv"}},
		{name: "", args: args{f: "./data/tests/test4.csv"}},
		{name: "", args: args{f: "./data/tests/test5.csv"}},
		{name: "", args: args{f: "./data/tests/test6.csv"}},
		{name: "", args: args{f: "./data/tests/test7.csv"}},
		{name: "", args: args{f: "./data/tests/test8.csv"}},
		{name: "", args: args{f: "./data/tests/test9.csv"}},
		{name: "", args: args{f: "./data/tests/test10.csv"}},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			file, _ := os.Open(tt.args.f)
			defer file.Close()
			s := bufio.NewScanner(file)
			tx := ReadTexts(s)
			for i := range tx {
				tx[i] = strings.TrimSpace(strings.Replace(tx[i], "  ", " ", -1))
				tx[i] = joinBoundaries(tx[i])
			}
			tx = slices.DeleteFunc(tx, func(i string) bool { return i == "" })
			slices.Sort(tx)
			tx = slices.Compact(tx)
			c := NewCorpus(tx)
			c.transitions = NewTransitions(c, tk)
			c.ngrams = ToNgrams(c.texts, tk, c.transitions, 0.1)
			c.texts = SplitTriplets(c.texts, c.ngrams)
			rules := ToRules(c.texts)

			for _, p := range perms {
				rules1 := rules
				for _, pp := range p {
					rules1 = mergers[pp].apply(rules)
				}
				rules1 = SetIDs(rules1)
				rules1 = ApplyFactor(rules1)
				g := Grammar{Rules: rules1}
				os.WriteFile("./data/tests/out/tmpMain.jsgf", []byte(g.printMain()), 0644)
				exec.Command("./data/tests/out/gsgf", "generate", "./data/tests/out/tmpMain.jsgf", "-o", "./data/tests/out/outMain.txt").Run()
				file, _ = os.Open("./data/tests/out/outMain.txt")
				defer file.Close()
				s = bufio.NewScanner(file)
				txx := ReadTexts(s)
				slices.Sort(txx)
				txx = slices.Compact(txx)
				assert.ElementsMatch(t, tx, txx)
			}
		})
	}
}
